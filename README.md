# DCD Vision - Анализ автомобилей с использованием ИИ

## Обзор проекта

Веб-приложение для анализа автомобильных изображений с использованием моделей компьютерного зрения. Система выполняет сегментацию деталей автомобиля и обнаружение повреждений с последующей генерацией отчетов в формате Excel.

## Архитектура системы

### Основные компоненты

- **main.py** - основной FastAPI сервер с эндпоинтами обработки изображений
- **core/model_manager.py** - управление моделями Roboflow и их инициализация
- **core/image_processor.py** - обработка изображений и создание визуализаций
- **static/** - клиентские ресурсы (CSS, JavaScript)
- **templates/** - HTML шаблоны

### Структура обработки

1. **Загрузка изображений** через веб-интерфейс с поддержкой множественной загрузки
2. **Параллельная обработка** с использованием нескольких моделей Roboflow
3. **Фильтрация и маппинг классов** в русскоязычные названия
4. **Генерация визуализаций** с цветовой сегментацией
5. **Создание отчетов Excel** с разделением по типам (детали/повреждения)

## Логика основных блоков

### Обработка деталей автомобиля
- **Модель колес** (parts-car): обнаружение колесных дисков, шин, крыши
- **Модель дверей** (car-parts-ulbml): обнаружение дверей, фар, зеркал
- **Основная модель** (cars-parts-and-damages): обнаружение основных элементов кузова
- **Результат**: объединение предсказаний с фильтрацией конфликтов

### Обработка повреждений автомобиля
- **Модель FRMNL** (car-damage-detection-frmnl): обнаружение трещин, царапин, вмятин
- **Модель VYHVW** (car-damage-detection-vyhvw): обнаружение повреждений кузова
- **Модель Bilgi** (bilgi-university-car-damage): обнаружение складок, утраты фрагментов
- **Модель коррозии** (corrosion-hsmae): обнаружение поверхностной коррозии
- **Результат**: фильтрация по разрешенным классам с маппингом на русские названия

### Генерация отчетов
- **Excel структура**: два листа (ДЕТАЛИ, ПОВРЕЖДЕНИЯ)
- **Группировка**: по именам файлов с разделением предсказаний
- **Экспорт**: как индивидуальные отчеты, так и сводный по всем файлам

## Детектируемые классы (русские названия)

### Детали автомобиля
- КРЫЛО П
- БОКОВИНА В СБ З
- СТЕКЛО ЛОБОВОЕ
- СТЕКЛО ЗАДНЕЕ
- НОМЕРНОЙ ЗНАК З
- НОМЕРНОЙ ЗНАК П
- БАМПЕР
- КАПОТ
- РАДИАТОР
- КОЛЕСНЫЙ ДИСК
- ШИНА
- КРЫША
- Стекло
- ЭМБЛЕМА ПРОИЗВОДИТЕЛЯ
- ЛЮЧОК Т/БАКА
- ДВЕРЬ З Л
- ДВЕРЬ З ПР
- ГАБ ФОНАРЬ З ПР
- ГАБ ФОНАРЬ З Л
- ДВЕРЬ П Л
- ДВЕР П ПР
- ФАРА В СБОРЕ Л
- ФАРА В СБОРЕ ПР
- ЗЕРКАЛО НАР Л
- ЗЕРКАЛО НАР ПР

### Повреждения автомобиля
- Складка
- Утрата фрагментов
- Трещина
- Царапина
- Вмятина
- Поверхностная коррозия

## API эндпоинты

- `GET /` - главная страница
- `POST /upload` - обработка деталей автомобиля
- `POST /upload_damage` - обработка повреждений
- `POST /upload_full_union` - полное объединение (детали + повреждения)
- `GET /export/excel/all` - экспорт всех результатов
- `GET /export/excel/{file_id}` - экспорт результата одного файла
- `GET /models/status` - статус моделей

## Технологии

- **Backend**: FastAPI, Python 3.8+
- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **ML**: Roboflow API, Supervision, OpenCV
- **Визуализация**: PIL, NumPy
- **Отчеты**: OpenPyXL

## Запуск

```bash
pip install -r requirements.txt
python main.py
```

Приложение будет доступно на http://localhost:8001
